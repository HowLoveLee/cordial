{% extends 'base.html' %}

{% load static %}

{% block content %}
    <p>EXAM REGISTRATION PROCESS</p>
    <button onclick="goBack()">Go Back</button>
    
    <div id="exam-list">
        {% for exam in exams %}
            <div class="exam-item">
                <h3>{{ exam.name }}</h3>
                <p><strong>Description:</strong> {{ exam.description }}</p>
                <p><strong>Duration:</strong> {{ exam.duration }} minutes</p>
                <p><strong>Locations:</strong></p>
                <ul>
                    {% for location in exam.locations.all %}
                        <li>{{ location.name }} ({{ location.full_address }})</li>
                    {% endfor %}
                </ul>
                <!-- Select button for each exam -->
                <button onclick="selectExam('{{ exam.name }}')">Select this Exam</button>
            </div>
        {% endfor %}
    </div>


    <!-- Calendar container -->
    <div id="calendar"></div>
    <!-- Time Selection -->
    <div id="time-selection">
        <h2>Select a Time:</h2>
        <div id="time-buttons"></div>
    </div>
    <br>
    <br>
        <!-- Selected exam label -->
    <form method="POST" action="{% url 'exam_registration_process' %}">
        {% csrf_token %}
        <label for="selected-exam">Selected Exam: </label>
        <span id="selected-exam-label">None</span>
        <input type="hidden" id="selected-exam-input" name="exam_name" value="">
        <br>
        <label for="selected-date">Selected Date: </label>
        <span id="date-selected-label">None</span>
        <input type="hidden" id="selected-date-input" name="exam_date" value="">
        <br>
        <label for="selected-time">Selected Time: </label>
        <span id="time-selected-label">None</span>
        <input type="hidden" id="selected-time-input" name="exam_time" value="">
        <br>
        <button type="submit" id="submit-button" >Submit</button>
    </form>

    <script>
    // Function to go back
function goBack() {
    window.history.back();
}

// Function to select an exam
function selectExam(examName) {
    const selectedExamLabel = document.getElementById('selected-exam-label');
    const selectedExamInput = document.getElementById('selected-exam-input');
    const submitButton = document.getElementById('submit-button');

    // Update exam selection
    selectedExamLabel.textContent = examName;
    selectedExamInput.value = examName;

    // Check if all fields are filled
    enableSubmitButton();
}

// Function to handle date selection
document.addEventListener('DOMContentLoaded', () => {
    const calendar = new VanillaCalendar('#calendar', {
        actions: {
            clickDay(e, selectedDate) {
                const selectedDateLabel = document.getElementById('date-selected-label');
                const selectedDateInput = document.getElementById('selected-date-input');

                // Update date selection
                selectedDateLabel.textContent = selectedDate;
                selectedDateInput.value = selectedDate;

                // Check if all fields are filled
                enableSubmitButton();
            },
        },
    });
    calendar.init();
});

// Function to generate time buttons in 12-hour format
function generateTimeButtons(startHour, endHour, intervalMinutes) {
    const timeButtonsContainer = document.getElementById('time-buttons');
    const selectedTimeLabel = document.getElementById('time-selected-label');
    const selectedTimeInput = document.getElementById('selected-time-input');

    for (let hour = startHour; hour <= endHour; hour++) {
        const period = hour >= 12 ? 'PM' : 'AM';
        const displayHour = hour > 12 ? hour - 12 : hour;

        for (let minutes = 0; minutes < 60; minutes += intervalMinutes) {
            const formattedTime = `${displayHour}:${minutes.toString().padStart(2, '0')} ${period}`;
            const button = document.createElement('button');

            button.className = 'time-index';
            button.textContent = formattedTime;
            button.addEventListener('click', function (e) {
                e.preventDefault();

                // Update time selection
                selectedTimeLabel.textContent = formattedTime;
                selectedTimeInput.value = formattedTime;

                // Check if all fields are filled
                enableSubmitButton();
            });

            timeButtonsContainer.appendChild(button);
        }
    }
}

// Enable submit button if all inputs are filled
function enableSubmitButton() {
    const examInput = document.getElementById('selected-exam-input').value;
    const dateInput = document.getElementById('selected-date-input').value;
    const timeInput = document.getElementById('selected-time-input').value;

    const submitButton = document.getElementById('submit-button');

    // Enable button if all fields are filled
    if (examInput && dateInput && timeInput) {
        submitButton.disabled = false;
    } else {
        submitButton.disabled = true;
    }
}

// Generate time buttons from 7:00 AM to 4:00 PM with 30-minute intervals
generateTimeButtons(7, 16, 30);

    </script>
{% endblock %}
